<!DOCTYPE html>
<html lang="ca">
<head>
  <meta charset="UTF-8">
  <title>üõ†Ô∏è Configuraci√≥ Oracle</title>
  <link rel="stylesheet" href="estilsunitats.css">
  <link rel="stylesheet" href="https://cdn.hugeicons.com/font/hgi-stroke-rounded.css" />
</head>
<body>

<header>
  <a href="index.html">
      <!--<img src="https://upload.wikimedia.org/wikipedia/commons/5/50/Oracle_logo.svg" alt="Oracle Logo"> -->
      <img src="imgs/ASGBD.png" alt="M√≤dul ASGBD">
  </a>
  <h1>ASGBD   -    Configuraci√≥ Oracle</h1>
</header>

<nav>
  <h3>√çndex</h3>
  <a href="#entorn">Conf. Entorn</a>
  <a href="#connexions">Conf. Connexions</a>
  <a href="#instancia">Conf. Inst√†ncia</a>
  <a href="#admin">Comptes administraci√≥</a>
  <a href="#arrancada">Arrancada i Parada</a>
  <a href="#emm">Conf. emmagatzemament</a>
  <a href="#diccionari">Diccionari de dades en Oracle</a>
  <a href="#quadern">Quadern de bit√†cola</a>
  <a href="#logs">Fitxers LOG</a>
  <a href="#altres-recursos">Altres Recursos</a>
</nav>

<main>

  

  <section id="entorn">
    <h1>Configuraci√≥ d'un SGBD</h1> <hr>
    <h2>Configuraci√≥ de l‚Äôentorn</h2>
  
    <h3> Variables d‚Äôentorn essencials</h3>
    <ul>
      <li><strong>ORACLE_HOME</strong>: Ruta on est√† instal¬∑lat el software d‚ÄôOracle (binaris, biblioteques...)</li>
      <li><strong>ORACLE_BASE</strong>: Ruta arrel on es guarden dades, configuracions, logs i m√©s</li>
      <li><strong>ORACLE_SID</strong>: Identificador de la inst√†ncia Oracle amb la qual es treballar√†</li>
      <li><strong>PATH</strong>: Variable del S.O. per accedir a les ordres d‚ÄôOracle des de qualsevol ruta (ex: <code>sqlplus</code>)</li>
      <li><strong>NLS_LANG</strong>: Defineix idioma, territori i charset (ex: <code>SPANISH_SPAIN.WE8MSWIN1252</code>)</li>
    </ul>
  
    <h3>üêß En Linux</h3>
    <p>Pots veure o configurar aquestes variables amb:</p>
    <pre>
  $ echo $ORACLE_SID
  $ echo $ORACLE_HOME
  $ export ORACLE_SID=orclcdb     # Canviar el valor de ORACLE_SDI
  $ echo $ORACLE_BASE
  $ env       # Llista totes les variables d‚Äôentorn
    </pre>

    <h3> Exemple de configuraci√≥</h3>
    <pre>
  export ORACLE_HOME=/opt/oracle/product/21c/dbhome_1
  export ORACLE_BASE=/opt/oracle
  export ORACLE_SID=costera
  export PATH=$ORACLE_HOME/bin:$PATH   </pre>
    <!-- export NLS_LANG=SPANISH_SPAIN.WE8MSWIN1252  -->
   
    <p>O fer canvis permanents en  bashrc</p>
    <pre>vi ~/.bashrc
---   fer canvis  
---   guardar
---   carregar canvis sense reiniciar
source ~/.bashrc       </pre>
  
    <h3>üñ•Ô∏è En Windows</h3>
    <strong>
    <ul>
      <li> Des de cmd amb ECHO  (el path)</li>
      <li> La resta de configuracions, des del registre de windows (REGEDIT)</li>
    </ul> </strong>
    
    <pre>
  > echo %PATH%
  > set
      </pre>
      <p>Pots modificar-les (el PATH) des de <em>Propietats del sistema ‚Üí Variables d'entorn</em>.</p>
      <img src="imgs/regedit-captura.png" class="imatge-dreta"  alt="stop" style="width: 50%">
      <p>Per vore les varibles d'entorn d'ORACLE s'ha de fer amb el (REGEDIT) i dins buscar  ORACLE_HOME  per exemple</p>
    <p>Pots modificar-les des del <strong>Registre (regedit)</strong></p>
    
    
    <h3>üîß Exercici pr√†ctic suggerit</h3>
    <p>
      Comprova el valor actual del teu <code>ORACLE_SID</code>, i canvia‚Äôl a una altra inst√†ncia com ‚Äú<code>costera</code>‚Äù o ‚Äú<code>ribera</code>‚Äù. Despr√©s obre el <strong>regedit</strong> i comprova on apunta <code>ORACLE_HOME</code>.
    </p>
    <h4>Altres variables d'entorn interessants en REGEDIT</h4>
    <ul> <CODE>
      <li> ORA_SID_AUTOSTART</li>
      <li> ORA_SID_SHUTDOWN</li>
      <li> ORA_SID_SHUTDOWN_TIMEOUT</li>
      <li> ORA_SID_SHUTDOWNTYPE</li> </CODE>
    </ul>
    <h3> Bones pr√†ctiques</h3>
    <ul>
      <li> Configura correctament l‚Äôentorn abans d‚Äôexecutar qualsevol eina com <code>sqlplus</code> o <code>dbca</code></li>
      <li> Canvia l‚ÄôORACLE_SID segons la base de dades amb qu√® vols treballar</li>
      <li> Si tens m√©s d‚Äôuna base de dades, assegura‚Äôt que les variables s√≥n correctes per a cada sessi√≥</li>
      <li> ORACLE_BASE i ORACLE_HOME s√≥n essencials per al correcte funcionament del SGBD</li>
    </ul>
  
  

  </section>
  



  <section id="connexions">
    <h2>Configuraci√≥ de les connexions</h2>
    <img src="imgs/port1521.png" class="imatge-dreta"  alt="stop" style="width: 30%">
    <p>‚ö†Ô∏è‚ö†Ô∏è En Windows, no deixar APIPA activat. Posar IP manualment</p>
    <p>‚ö†Ô∏è‚ö†Ô∏è Permetre el port 1521 en el Firewall  üõ°Ô∏èüß±üî•</p>
    <h3> Components clau per connectar-se a Oracle</h3>
    <p>Per establir una connexi√≥ entre un client i una base de dades Oracle, es necessita:</p>
    <ul>
      <li> Un <strong>listener</strong> actiu al servidor, configurar amb el fitxer <code>listener.ora</code></li>
      <li> Un fitxer <strong>tnsnames.ora</strong> al client (i opcionalment al servidor)</li>
      <li> El fitxer <strong>sqlnet.ora</strong> per determinar l'ordre de resoluci√≥</li>
    </ul>
  
    <h3>üìÅ Fitxers implicats (ubicaci√≥ t√≠pica)</h3>
    <ul>
      EN EL SERVIDOR  (LINUX) 
      <li><code>$ORACLE_HOME/network/admin/listener.ora</code></li>
      <li><code>$ORACLE_HOME/network/admin/sqlnet.ora</code></li>
      EN EL CLIENT
      <li><code>$ORACLE_HOME/network/admin/tnsnames.ora</code></li>
    </ul>
  
    <ul>
      EN EL SERVIDOR (WINDOWS)  
      <li><code>%ORACLE_BASE%/homes/%ORACLE_HOME_NAME%/network/admin/listener.ora</code></li>
      <li><code>%ORACLE_BASE%/homes/%ORACLE_HOME_NAME%/network/admin/sqlnet.ora</code></li>
      EN EL CLIENT
      <li><code>%ORACLE_BASE%/homes/%ORACLE_HOME_NAME%/network/admin/tnsnames.ora</code></li>
    </ul>    
     
    <h3> Fitxer sqlnet.ora</h3>
    <p>Defineix l'ordre de cerca per resoldre noms:</p>
    <pre>
  SQLNET.AUTHENTICATION_SERVICES = (NONE)
  NAMES.DIRECTORY_PATH = (TNSNAMES, EZCONNECT)
    </pre>
  
    <h3>üõ†Ô∏è Eines per configurar la xarxa</h3>
    <ul>
      <li><strong>netca</strong>: assistent per crear listeners i serveis ‚ö†Ô∏è Important, executar amb administrador</li>
      <li><strong>netmgr</strong>: gesti√≥ gr√†fica de connexions Oracle</li>
    </ul>
  
    <h4>Exemple:</h4>
    <pre>
  $ netca     # Inicia l‚Äôassistent gr√†fic (en Linux o CMD)
  $ netmgr    # (tamb√© gr√†fic)
    </pre>
  
    <h3>üîç Verificaci√≥ amb tnsping</h3>
    <p>Permet comprovar si la configuraci√≥ funciona i si el listener est√† responent:</p>
    <p><strong>Esta verificaci√≥ t√© sentit si es fa des d'una m√†quina distinta al servidor</strong></p>
    <pre>
  $ tnsping orcl
    </pre>
  
    <p>Eixida esperada:</p>
    <pre>
  Used parameter files:
  /opt/oracle/product/21c/dbhome_1/network/admin/sqlnet.ora
  
  Used TNSNAMES adapter to resolve the alias
  Attempting to contact (DESCRIPTION = (ADDRESS = (PROTOCOL = TCP)(HOST = localhost)(PORT = 1521))...)
  OK (10 msec)
    </pre>
  
    <h3>‚ö†Ô∏è Errors habituals</h3>
    <ul>
      <li> Listener no iniciat ‚Üí <code>lsnrctl start</code></li>
      <li> El servei no est√† registrat correctament ‚Üí revisar <code>GLOBAL_DBNAME</code> o <code>SERVICE_NAME</code></li>
      <li> El client no troba el tnsnames.ora ‚Üí revisar ruta o variable <code>TNS_ADMIN</code></li>
    </ul>
  
    <h3>‚úÖ Bones pr√†ctiques</h3>
    <ul>
      <li> Fer <code>tnsping</code> abans de provar una connexi√≥ completa</li>
      <li> Mantenir una c√≤pia de seguretat dels fitxers de configuraci√≥</li>
      <li> En producci√≥, usar noms DNS en lloc de IPs i restringir ports al tallafoc</li>
    </ul>

    <h3> Primera connexi√≥</h3>
    <pre>
      $ sqlplus / as sysdba
      C:\Users\enric> sqlplus / as sysdba
      .............
      SQL> show con_name
      SQL> select name from v$database;
      SQL> show user
      SQL> show pdbs
      SQL> show sga
    </pre>

    <h3> Navegar per les PDBs</h3>
    <pre>
      $ sqlplus / as sysdba
      SQL> show con_name
      SQL> select name from v$database;
      SQL> show user
      SQL> show pdbs
      SQL> alter session set CONTAINER=PDB1;
      SQL> show pdbs
      SQL> alter session set CONTAINER=PDB2;
      SQL> show pdbs
      SQL> alter session set CONTAINER=cdb$root;
      SQL> show pdbs
    </pre>

    <h3>üîß Exercicis pr√†ctics suggerits</h3>
    <p>
      ‚úîÔ∏èInstal¬∑lar Oracle Instant Client (sqlplus) en altra m√†quina de la mateixa xarxa, configurar i fer:  <code>tnsping</code>.
    </p> 
    <p>
      ‚úîÔ∏èInstal¬∑lar SQL Developer en altra m√†quina de la mateixa xarxa, configurar nova connexi√≥ i provar </code>.
    </p> 
  </section>
  
  <section id="stop">
    <img src="imgs/stop.png" class="imatge-esquerra"  alt="stop" style="width: 6%">
    <h2>Abans de continuar.... </h2>
    <h1>Fem un rep√†s de SQL</h1>
    <h3><a href="repas-sql.html"> Acc√©s al Rep√†s ..   </a> </h3>

  </section>


<section id="instancia">
  <h2>Configuraci√≥ de la inst√†ncia</h2>

  <h3>üìò Qu√® √©s la inst√†ncia?</h3>
  <p>En Oracle Database, una inst√†ncia √©s el conjunt de processos en mem√≤ria i estructures de mem√≤ria que
     gestionen l'acc√©s f√≠sic i l'√∫s d'una base de dades Oracle.</p>
     <h4>La Inst√†ncia √©s el SGBD en execuci√≥</h4>
  <p>      Una inst√†ncia Oracle necessita una configuraci√≥ espec√≠fica per funcionar correctament: mem√≤ria, rutes, noms, processos, etc.
    Aquesta configuraci√≥ es defineix mitjan√ßant <strong>fitxers de par√†metres</strong>.   </p>

  <h3> Fitxers de par√†metres</h3>
  <ul>
    <li><strong>spfile</strong> ‚Äì Fitxer binari (Server Parameter File), llegit autom√†ticament en iniciar la inst√†ncia.</li>
    <li><strong>pfile</strong> ‚Äì Fitxer de text (init<SID>.ora), utilitzat com a alternativa o c√≤pia editable.</li>
  </ul>

  <h4> Crear un PFILE a partir d‚Äôun SPFILE</h4>
  <pre>SQL> CREATE PFILE FROM SPFILE;</pre>

  <h4> Crear un SPFILE a partir d‚Äôun PFILE</h4>
  <pre>SQL> CREATE SPFILE FROM PFILE;</pre>

  <p> Ubicaci√≥ t√≠pica: (en linux)</p>
  <pre>$ORACLE_BASE/oradata/dbconfig/NOMCDB/dbs/spfileNOMCDB.ora</pre>
  <p> Ubicaci√≥ t√≠pica: (en windows)</p>
  <pre>$ORACLE_BASE/database/spfileSID.ora</pre>
  <p>On SID √©s el nom de la CDB</p>
  <h4>‚ö†Ô∏è El fitxer spfile no es pot manipular directament, o es produir√† un error. Els valors del fitxer s'han de modificar 
    mitjan√ßant sent√®ncies SQL (<code> ALTER SYSTEM SET </code>)</h4>
  <p>Dins del fitxer spfile___  es guaden els valors dels <strong>par√†metres</strong> de la inst√†ncia, que es carregen en mem√≤ria nom√©s esta arranca.</p>

  <h3> Tipus de par√†metres</h3>
  <ul>
    <li><strong>Est√†tics</strong>: Nom√©s es poden modificar reiniciant la inst√†ncia</li>
    <li><strong>Din√†mics</strong>: Es poden canviar en temps real sense reiniciar</li>
    <li><strong>Scope:</strong>
      <ul>
        <li><code>MEMORY</code> ‚Äì Canvi temporal (fins al proper reinici)</li>
        <li><code>SPFILE</code> ‚Äì S‚Äôemmagatzema per al proper reinici</li>
        <li><code>BOTH</code> ‚Äì Canvi immediat i persistent</li>
      </ul>
    </li>
  </ul>

  <h3> Consultar par√†metres actuals</h3>
  <p>Consulta de par√†metres:</p>
  <pre>SQL> SHOW PARAMETER   o   SQL> SHOW PARAMETER sga;</pre>
  <pre>SQL> SHOW SPPARAMETER   o   SQL> SHOW SPPARAMETER sga;</pre>
  <p>SHOW PARAMETERS->Consulta els valors actuals en √∫s per la inst√†ncia.<br>SHOW SPPARAMETERS
    ->Consulta els valors que hi ha desats a l‚ÄôSPFILE (Server Parameter File)</p>
  <p>Consulta de totes les fonts dels valors:</p>
  <pre>SQL> SELECT name, value, isspecified, isdefault , issys_modifiable, isses_modifiable
FROM v$parameter 
WHERE name LIKE 'sga%';</pre>

  <h3> Modificar un par√†metre</h3>
  <p>Per exemple, modificar la mida de la SGA:</p>
  <pre>SQL> ALTER SYSTEM SET sga_target=800M SCOPE=SPFILE;</pre>
  <p><em>(cal reiniciar perqu√® tingui efecte)</em></p>
  <pre>Exemples de parametres dinamics i estatics
    sessions        estatic
    open_cursors    dinamic
    processes       estatic
    sort_area_size  dinamic
    optimizer_mode  dinamic
  </pre>

  <h3> Reinici de la inst√†ncia</h3>
  <p>Per aplicar canvis definitius:</p>
  <pre>
SQL> SHUTDOWN IMMEDIATE;
SQL> STARTUP;
  </pre>

  <h3> Resum d'ordres √∫tils</h3>
  <ul>
    <li><code>SHOW PARAMETER nom</code> ‚Äì Consulta r√†pida</li>
    <li><code>ALTER SYSTEM SET ...</code> ‚Äì Per canviar valors</li>
    <li><code>CREATE PFILE FROM SPFILE</code> ‚Äì Exportar config bin√†ria</li>
    <li><code>CREATE SPFILE FROM PFILE</code> ‚Äì Generar spfile</li>
    <li><code>STARTUP PFILE='...'</code> ‚Äì Iniciar amb fitxer concret</li>
  </ul>

  <h3>‚ö†Ô∏è Bones pr√†ctiques</h3>
  <ul>
    <li> No modificar directament l‚ÄôSPFILE (nom√©s amb SQL)</li>
    <li> Fer c√≤pia del PFILE abans de fer canvis</li>
    <ul><li>‚ö†Ô∏è Canvis incorrectes poden impedir que la inst√†ncia arranque</li> </ul> 
  </ul>
  <hr>
  <p> <code> ==> Com saber quants parametres hi ha en la inst√†ncia?</code></p>
  <pre>SELECT COUNT(*) FROM v$spparameter WHERE value IS NOT NULL;
SELECT COUNT(*) FROM v$parameter WHERE value IS NOT NULL;
</pre>
</section>



  <section id="admin">
    <h2>Comptes d‚Äôadministraci√≥</h2>
  
    <h3>üë§ Comptes d'administraci√≥ predeterminats</h3>
    <p>Quan es crea una base de dades Oracle (CDB o PDB), es generen autom√†ticament diversos comptes especials:</p>
    <ul>
      <li><strong>SYS</strong>: usuari principal amb privilegis totals sobre la base de dades.</li>
      <li><strong>SYSTEM</strong>: usuari administratiu per tasques generals i desenvolupament.</li>
      <li><strong>PDBADMIN</strong>: usuari administrador dins d‚Äôuna PDB espec√≠fica.</li>
    </ul>
  
    <p> Aquests comptes es creen autom√†ticament en el moment de crear la base de dades amb l‚Äôeina <code>DBCA</code> o amb SQL.</p>
  
    <h3> Rols associats</h3>
    <ul>
      <li><strong>SYSDBA</strong>: acc√©s complet, inclou totes les capacitats (startup, shutdown, backup, etc.).</li>
      <li><strong>SYSOPER</strong>: rol amb permisos limitats a operacions b√†siques (iniciar, aturar, consultar).</li>
      <li><strong>SYSBACKUP</strong>, <strong>SYSDG</strong>, <strong>SYSKM</strong>: rols especialitzats (backup, dataguard, encriptaci√≥).</li>
    </ul>
  
    <h3>üìç Ubicaci√≥ dels comptes</h3>
    <p>
      Els comptes SYS i SYSTEM s‚Äôubiquen dins la <strong>CDB (contenidor principal)</strong> i tamb√© dins de cada una de les <strong>PDB</strong>. 
      Estos comptes s√≥n uns comptes "especials" anomenats COMUNS, que est√°n en totes les PDBs i en la CDB principal
    </p>
  
    <p> Es pot canviar de contenidor amb:</p>
    <pre>SQL> ALTER SESSION SET CONTAINER = nom_pdb;</pre>
  
    <h3> Canvi de contrasenya</h3>
    <pre>
  SQL> ALTER USER system IDENTIFIED BY nova_contrasenya;
  SQL> ALTER USER pdbadmin IDENTIFIED BY segura123;
    </pre>
  
    <h3> Bones pr√†ctiques</h3>
    <ul>
      <li> Canviar les contrasenyes per defecte despr√©s de la instal¬∑laci√≥</li>
      <li> Limitar l‚Äô√∫s de SYS nom√©s a tasques cr√≠tiques</li>
      <li> Crear usuaris administradors propis amb rols espec√≠fics si cal</li>
      <li>‚ö†Ô∏è No treballar habitualment amb SYS/SYSTEM, especialment en entorns de producci√≥</li>
    </ul>
  
    <h3>üîç Consultar rols assignats</h3>
    <pre>
  SQL> SELECT * FROM dba_role_privs WHERE grantee = 'SYSTEM';
    </pre>
  
    <h3>üß™ Exemple pr√†ctic</h3>
    <p>Crear un nou usuari administrador dins una PDB:</p>
    <pre>
  SQL> ALTER SESSION SET CONTAINER = nom_pdb;
  SQL> CREATE USER admin_pdb IDENTIFIED BY 1234;
  SQL> GRANT dba TO admin_pdb;      </pre>
    <p>Donar m√©s privil√®gis...</p>
    <pre>GRANT SYSDBA TO admin_pdb;</pre>
    <pre>---  I es pot connectar com sysdba
sqlplus admin_pdb/1234 AS SYSDBA     </pre>
<p>Aix√≤ li d√≥na el mateix nivell d'acc√©s que SYS, per√≤ sense ser el propietari del diccionari de dades. √âs el m√†xim privilegi possible per a un usuari que no √©s SYS</p>
    <p>En altres SGBDs, l'usuari administrador varia...</p>
    <table >
  <caption >Comparativa d'usuaris administradors</caption>
  <thead>
    <tr>
      <th >Sistema</th>
      <th >Usuari administrador</th>
      <th >Descripci√≥ breu</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td >Oracle</td>
      <td ><code>SYS</code></td>
      <td >Superusuari amb acc√©s al diccionari de dades.</td>
    </tr>
    <tr>
      <td >MySQL</td>
      <td ><code>root</code></td>
      <td >Superusuari amb tots els privilegis sobre el servidor.</td>
    </tr>
    <tr>
      <td >PostgreSQL</td>
      <td ><code>postgres</code></td>
      <td >Superusuari creat per defecte durant la instal¬∑laci√≥.</td>
    </tr>
  </tbody>
</table>



  </section>
  

  <section id="arrancada">
    <h2>Arrancada i parada de la inst√†ncia Oracle</h2>
  
    <h3> Com arranca una inst√†ncia Oracle?</h3>
    <p>Una inst√†ncia Oracle pot estar en diferents estats:</p>
    <ul>
      <li><strong>NOMOUNT</strong>: nom√©s carregat l‚ÄôSPFILE/PFILE. No hi ha acc√©s a la BBDD.</li>
      <li><strong>MOUNT</strong>: es carrega el control file, per√≤ la BBDD continua tancada.</li>
      <li><strong>OPEN</strong>: la BBDD est√† completament disponible per a operacions.</li>
    </ul>
  
    <p>Ordres per arrancar pas a pas:</p>
    <pre>
  SQL> STARTUP NOMOUNT;
  SQL> STARTUP MOUNT;
  SQL> ALTER DATABASE OPEN;
    </pre>
  
    <h3> Arrancada completa</h3>
        <p>Per arrancar la base de dades directament a mode <code>OPEN</code>:</p>
    <pre>SQL> STARTUP;</pre>
    <img src="imgs/estats-arrancada.png" class="imatge-dreta"  alt="stop" style="width: 46%">
    <p>‚ö†Ô∏è Necessites rols <code>SYSDBA</code> o <code>SYSOPER</code> per fer aquesta acci√≥.</p>
  
    <h3> Parada de la inst√†ncia</h3>
    <p>Opcions disponibles:</p>
    <ul>
      <li><strong>IMMEDIATE</strong> ‚Äì Atura connexions de forma controlada (recomanat)</li>
      <li><strong>NORMAL</strong> ‚Äì Espera que els usuaris es desconnecten</li>
      <li><strong>ABORT</strong> ‚Äì Tall immediat (pot deixar la base de dades en estat incoherent)</li>
    </ul>
  
    <p>Exemples:</p>
    <pre>
  SQL> SHUTDOWN IMMEDIATE;
  SQL> SHUTDOWN NORMAL;
  SQL> SHUTDOWN ABORT;
    </pre>
  
    <h3> En Windows</h3>
    <p>Executar <code>sqlplus / as sysdba</code> com a usuari <code>oracle</code> o administrador:</p>
    <pre>
  C:\> sqlplus / as sysdba
  SQL> STARTUP;
  SQL> SHUTDOWN IMMEDIATE;
    </pre>
  
    <h3>üêß En Linux</h3>
    <p>Cal que les variables d‚Äôentorn estiguin ben configurades:</p>
    <pre>
  $ . oraenv
  $ sqlplus / as sysdba
  SQL> STARTUP;
  SQL> SHUTDOWN IMMEDIATE;
    </pre>
  
    <h3> Gestionar contenidors (PDB)</h3>
    <p>Despr√©s d'obrir la CDB, cal obrir les PDB individualment si no estan configurades per obrir-se autom√†ticament:</p>
    <pre>
  SQL> ALTER PLUGGABLE DATABASE ALL OPEN;
  SQL> ALTER PLUGGABLE DATABASE nom_pdb OPEN;
    </pre>
  
    <p>Per tancar-les:</p>
    <pre>
  SQL> ALTER PLUGGABLE DATABASE ALL CLOSE IMMEDIATE;
  SQL> ALTER PLUGGABLE DATABASE nom_pdb CLOSE IMMEDIATE;
    </pre>
  
    <h3> Bones pr√†ctiques</h3>
    <ul>
      <li> Utilitza sempre <code>SHUTDOWN IMMEDIATE</code> per evitar corrupcions</li>
      <li> Comprova que les PDB estan obertes despr√©s del <code>STARTUP</code></li>
      <li>‚ö†Ô∏è Si fas <code>ABORT</code>, executa <code>RECOVER</code> o revisa la coher√®ncia de la BBDD despr√©s</li>
      <li> Per entorns de pr√†ctiques, pots fer <code>STARTUP MOUNT</code> per estudiar fases inicials</li>
    </ul>
  
    <h3> Comprovar estat</h3>
    <pre>
  SQL> SELECT status FROM v$instance;
  SQL> SELECT name, open_mode FROM v$pdbs;
    </pre>
  </section>
  

  <section id="emm">
    <h2>Configuraci√≥ de l‚Äôemmagatzematge</h2>
  
    <h3> Qu√® √©s un tablespace?</h3>
        <p>  Un <strong>tablespace</strong> √©s una unitat l√≤gica d‚Äôemmagatzematge dins d‚ÄôOracle. Est√† format per un 
          o m√©s <strong>fitxers de dades</strong> (datafiles) que resideixen al disc i contenen les dades reals de la base de dades.  </p>
    <img src="imgs/tablespaces.png" class="imatge-esquerra"  alt="stop" style="width: 20%">
    <p>Cada datafile pot estar en un disc f√≠sic diferent</p>
    <p>Els usuaris guarden les seues dades en els tablespaces, com per exemple <code>USERS</code>, <code>TEMP</code>, <code>SYSTEM</code>, etc.</p>
    <p>Crear tablespaces addicionals ajuda a organitzar les aplicacions que es creen sobre la base d'esquemes</p>
    <p>Utilitzar tablespaces √©s fonamental per a la seguretat</p>
  
    <h3> M√®todes de gesti√≥ de l‚Äôespai</h3>
    <ul>
      <li><strong>Manual:</strong> l‚Äôadministrador ha de crear i ampliar els fitxers de dades manualment.</li>
      <li><strong>Autom√†tic:</strong> el sistema crea i amplia els datafiles autom√†ticament amb <code>AUTOEXTEND</code>.</li>
    </ul>
  
    <h3> Tipus de tablespaces</h3>
    <ul>
      <li>Existeixen en instal¬∑lar <strong>SYSTEM, SYSAUX, UNDO, TEMP, USERS</strong> </li>
      <li>El tablespace USERS √©s el que es far√† servir per guardar dades de les taules dels usuaris 
        (si no es creen tablespaces addicionas per este menester)</li>
      <li>Es poden crear tablespaces TEMPORALS, PERMANENTS, DE SOLS LECTURA, i posar un tablespace OFFLINE o ONLINE</li>  
    </ul>


    <h3> Consultar informaci√≥ d‚Äôemmagatzematge</h3>
    <p>Consulta dels tablespaces:</p>
    <pre>
  SQL> SELECT tablespace_name, status from dba_tablespaces;
    </pre>
    <p>Consulta dels fitxers de dades: <strong>Molt √∫til per saber les rutes f√≠siques als fitxers del s.o.</strong></p>
    <pre>
  SQL> SELECT file_name, tablespace_name from dba_data_files;
    </pre>

    <h3> Crear un nou tablespace manualment</h3>
    <p>Exemple de creaci√≥ amb gesti√≥ manual:</p>
    <pre>
  SQL> CREATE TABLESPACE dades 
  DATAFILE '/opt/oracle/oradata/COSTERA/dades01.dbf' SIZE 10M;
    </pre>
  
    <p>Exemple amb autoextensi√≥ activada:</p>
    <pre>
  SQL> CREATE TABLESPACE dades 
  DATAFILE '/opt/oracle/oradata/COSTERA/dades01.dbf' 
  SIZE 10M 
  AUTOEXTEND ON 
  NEXT 5M 
  MAXSIZE 100M;
    </pre>
  
    <h3> Afegir un fitxer de dades a un tablespace</h3>
    <pre>
  SQL> ALTER TABLESPACE dades 
  ADD DATAFILE '/opt/oracle/oradata/COSTERA/dades02.dbf' SIZE 20M;
    </pre>    
  
    <h3> Ubicaci√≥ per defecte (si no s‚Äôespecifica)</h3>
    <p>Si no s‚Äôindica ruta expl√≠cita, Oracle fa servir la variable:</p>
    <pre>DB_CREATE_FILE_DEST</pre>
    <p>Si <code>DB_CREATE_FILE_DEST</code> no te valor, la ubicaci√≥ ser√† $ORACLE_HOME/dbs (en Unix/Linux)
       o %ORACLE_HOME%\database (en Windows)</p>
  
    <p>Exemple de creaci√≥ de tablespace/datafile amb ruta autom√†tica:</p>
    <pre>
  SQL> CREATE TABLESPACE dades123 DATAFILE 'dades123' SIZE 10M;
    </pre>
  
    <h3> Bones pr√†ctiques</h3>
    <ul>
      <li> Activa <code>AUTOEXTEND</code> per evitar errors per espai</li>
      <li> Assigna un tablespace espec√≠fic als usuaris nous (evita usar <code>SYSTEM</code>)</li>
      <li> Utilitza rutes clares i separades per a cada base de dades</li>
      <li>‚ö†Ô∏è Controla la mida m√†xima de creixement per no omplir el disc</li>
    </ul>
  
    <h3> Exemple complet</h3>
    <pre>
  CREATE TABLESPACE aplicacio 
  DATAFILE '/opt/oracle/oradata/COSTERA/aplicacio01.dbf' 
  SIZE 20M 
  AUTOEXTEND ON 
  NEXT 5M 
  MAXSIZE UNLIMITED;
  
  CREATE USER us_aplicacio IDENTIFIED BY 1234 
  DEFAULT TABLESPACE aplicacio 
  QUOTA UNLIMITED ON aplicacio;

  // Des de dins de l'usuari
  CREATE table tabla1 ( codi number(6),  Nom varchar2(40) )  TABLESPACE aplicacio;

  CREATE index indice1 on tabla1(nom DESC) TABLESPACE aplicacio;
    </pre>
  </section>
  

  <section id="diccionari">
    <h2>Diccionari de dades</h2>
  
    <h3>üìò Qu√® √©s el diccionari de dades?</h3>
    <p>
      El <strong>diccionari de dades</strong> d‚ÄôOracle √©s un conjunt de vistes especials que contenen metadades sobre:
    </p>
    <ul>
      <li> Taules, vistes, columnes</li>
      <li> Usuaris, rols i privilegis</li>
      <li> Estructura de la base de dades, espai, fitxers</li>
      <li> Permisos d'acc√©s i auditories</li>
    </ul>
  
    <p>El diccionari √©s gestionat autom√†ticament per Oracle i est√† format per milers de vistes prefixades per:</p>
    <ul>
      <li><code>USER_</code> ‚Üí Mostra dades del propi usuari connectat</li>
      <li><code>ALL_</code> ‚Üí Mostra dades accessibles per l‚Äôusuari (les seves i d‚Äôaltres)</li>
      <li><code>DBA_</code> ‚Üí Mostra totes les dades del sistema (requereix permisos de DBA)</li>
      <li><code>V$___</code> ‚Üí Vistes din√†miques</li>
      <li><code>TABS, DUAL, DICTIONARY</code> ‚Üí Vistes "legacy"</li>
    </ul>
    <p>El diccionari s'emmagatzema en l'esquema de SYS. El DD pertany a SYS</p>
    <p>SYS est√† present en CDB$ROOT i en totes les PDB</p>
    <p class="alert">Les dades del DD estan en MAJ√öSCULES</p>
    <hr>

    <h3>üîçüîç Consultes habituals</h3>
  
    <h4>üìÇ Taules i columnes</h4>
    <pre>
  -- Taules creades per l‚Äôusuari actual
  SELECT table_name FROM user_tables;
  
  -- Columnes d‚Äôuna taula concreta
  SELECT column_name, data_type, data_length 
  FROM user_tab_columns 
  WHERE table_name = 'EMPLEATS';
    </pre>
  
    <h4>üë§ Usuaris i rols</h4>
    <pre>
  -- Llista d‚Äôusuaris
  SELECT username FROM dba_users;
  
  -- Rols assignats a un usuari
  SELECT * FROM dba_role_privs WHERE grantee = 'SYSTEM';
    </pre>
  
    <h4>üîê Privilegis</h4>
    <pre>
  -- Privilegis d‚Äôusuari
  SELECT * FROM user_sys_privs;
  
  -- Privilegis de rol
  SELECT * FROM role_sys_privs WHERE role = 'DBA';
    </pre>
  
    <h4>üìÅ Estructures d‚Äôemmagatzematge</h4>
    <pre>
  -- Fitxers de dades
  SELECT file_name, tablespace_name, bytes/1024/1024 AS MB 
  FROM dba_data_files;
  
  -- Espai lliure
  SELECT tablespace_name, file_id, block_id, bytes/1024/1024 AS MB 
  FROM dba_free_space;
    </pre>
  
    <h3>üìò Bones pr√†ctiques</h3>
    <ul>
      <li> Utilitza <code>USER_</code> si treballes com a usuari no administrador</li>
      <li> Utilitza <code>DBA_</code> per fer auditories completes (nom√©s si ets <code>SYS</code> o tens <code>DBA</code>)</li>
      <li> Fes servir <code>DESCRIBE</code> o <code>DESC</code> per veure l‚Äôestructura de les vistes del diccionari</li>
    </ul>
  
    <h3> Consell final</h3>
    <p>El diccionari de dades √©s clau per con√®ixer l'estat intern de la base de dades, i resulta imprescindible per a administradors i desenvolupadors.</p>
  </section>
  



  <section id="quadern">
  
    <h2> üßæ Quadern de bit√†cola (Redo Log Files)</h2>
     <h3>üìí Qu√® √©s?</h3>
    <p>
      El <strong>quadern de bit√†cola</strong> en Oracle (en angl√®s, log file o redo log) √©s un concepte clau per garantir la recuperaci√≥ de dades 
      i la integritat del sistema en cas de fallada.
    </p>
    <p>El <strong>'quadern'</strong> es composa d'un grup de fitxers especials que Oracle utilitza per registrar tots els canvis que es fan a la base de dades, abans que aquests es confirmen 
      f√≠sicament als fitxers de dades</p>
    <p>Tamb√© conegut com:  Redo log files,  Fitxers de redo,  Fitxers de registre de redo</p>  
    <p> Els <strong>fitxers redo log</strong> s√≥n fitxers essencials que enregistren totes les modificacions fetes a la base de dades. 
      Aquest registre permet a Oracle <strong>recuperar les dades en cas de fallada</strong> abans que les dades siguin escrites definitivament als fitxers de dades.
    </p>
   <h3> üîß Per a qu√® serveix?</h3>
   <ul>
    <li>Permet recuperar la base de dades despr√©s d‚Äôuna fallada (ex: tall el√®ctric).</li>
    <li>Registra instruccions com INSERT, UPDATE, DELETE, etc.</li>
    <li>No registra consultes SELECT perqu√® no modifiquen dades.</li>
   </ul>

   <h3>üóÇÔ∏è Tipus de redo logs:</h3>
   <ul>
    <li>Redo logs en l√≠nia: S√≥n els principals. Oracle escriu cont√≠nuament en aquests.</li>
    <li>Redo logs d‚Äôarxiu (archived redo logs): Si la base de dades est√† en mode ARCHIVELOG, els redo logs antics es guarden per a recuperaci√≥ completa.</li>
   </ul>
   <p>Tamb√© s'anomenen ONLINE REDO LOG i  OFFLINE REDO LOG</p>

   <h3>üîÅ Funcionament c√≠clic</h3>
   <p>
     Oracle utilitza un conjunt de fitxers redo log en mode circular (anells). Quan un fitxer es plena, s‚Äôescriu al seg√ºent. 
     Quan es completa un cicle, torna a comen√ßar pel primer.
   </p>
   <p>Com m√©s grups de redo logs tinguis, m√©s efici√®ncia i seguretat ofereix el sistema.</p>

   <h3> Estructura t√≠pica</h3>
   <p>Una inst√†ncia pot tenir m√∫ltiples grups de redo logs, cadascun amb un o m√©s membres (fitxers f√≠sics replicats):</p>
      <pre>
   GROUP 1 ‚Üí redo01.log
   GROUP 2 ‚Üí redo02.log
   GROUP 3 ‚Üí redo03.log
   </pre>
   <img src="imgs/redolog.png" class="imatge-esquerra"  alt="stop" style="width: 26%">
    <p> Normalment hi ha tres fitxers Redo Log, que van rotant. Quan un es plena, pasa al seg√ºent, i quan l'√∫ltim es plena, pasa altra vegada al primer</p>
    <p>El proc√©s de mem√≤ria LGWR s'encarrega de fer a√ß√≤.</p>
    <pre>
    (for√ßar rotaci√≥ dels fitxers Redo Log)
    SQL> alter system switch logfile;
    </pre>

    <h3> Afegir un nou grup de redo logs</h3>
    <pre>
    SQL> ALTER DATABASE ADD LOGFILE GROUP 4 
    ('/opt/oracle/oradata/NOM_BBDD/redo04.log') SIZE 50M;
    </pre>

    <h3> Afegir un membre (fitxer addicional) a un grup existent</h3>
    <pre>
    SQL> ALTER DATABASE ADD LOGFILE MEMBER 
    '/opt/oracle/oradata/NOM_BBDD/redo01b.log' TO GROUP 1;
    </pre>

    <h3>üîç On es troben?</h3>
    Pots veure on estan consultant el DD:
     <pre>
     SELECT member FROM v$logfile; 
     select * from v$log; </pre>
     <h3>üìç Ubicaci√≥ t√≠pica dels redo logs</h3>
     <pre>/opt/oracle/oradata/NOM_BBDD/redo0X.log</pre>
     <p>(Es defineix durant la creaci√≥ de la base de dades amb <code>DBCA</code>)</p>
     <p class="alert">üß™ Practica: Busca en la maquina servidor la ruta concreta dels teus REDO LOGS</p>
    

<p>‚ö†Ô∏èEn un entorn de producci√≥, estos fitxers deurien estar en un disc f√≠sic diferent al que cont√© els datafiles</p>

<h3> En cas d‚Äôerror amb els redo logs</h3>
<p>Poden impedir l‚Äôinici de la base de dades. Per exemple, si s‚Äôesborra un fitxer o falla un disc.</p>
<p>Es pot fer servir una ordre com:</p>
<pre>SQL> ALTER DATABASE CLEAR UNARCHIVED LOGFILE GROUP 1;</pre>
<p>‚ö†Ô∏è <strong>Nom√©s per a casos d‚Äôemerg√®ncia!</strong></p>

<br><h3> ARCHIVELOG o  Offline Redo Log</h3>
<img src="imgs/archivelog.png" class="imatge-esquerra"  alt="stop" style="width: 26%">
<p>El Online Redo Log ve activat per defecte, per√≤ el Offline Redo Log ve desactivat per defecte</p>
<p>El proc√©s de mem√≤ria ARCH s'encarrega de portar el Offline Redo Log, tamb√© conegut com ARCHIVELOG.</p>
<P>ARCHIVELOG guarda fora de l√≠nia els arxuis redo log que no estan actius.
  D‚Äôesta manera, quan es fa la transici√≥ de l‚Äô√∫ltim al primer, abans el primer s‚Äôha guardat fora de l√≠nia, 
i no hi ha perill de sobreescriure transicions que ocupen massa espai</P>

<h3> Com activar el ARCHIVELOG</h3>
<pre>
SQL> archive log list
SQL> alter system set log_archive_dest_1='LOCATION=/archivelog/carpeta/arch' SCOPE=SPFILE;
SQL> alter system set log_archive_format='arch_%r_%t_%s.arc' scope=spfile;
SQL> alter system set LOG_ARCHIVE_START=TRUE SCOPE=spfile;
SQL> shutdown immeditate; startup mount;
SQL> alter database archivelog;
SQL> alter database open;
SQL> archive log list
SQL> select name, log_mode from v$database;
SQL> ALTER SYSTEM SWITCH LOGFILE;
</pre>

<h3> Bones pr√†ctiques</h3>
<ul>
  <li> Tenir almenys 3 grups de redo logs</li>
  <li> Tenir m√©s d‚Äôun membre per grup (redund√†ncia)</li>
  <li> Els redo logs han d‚Äôestar en discos r√†pids i fiables</li>
  <li> No compartir f√≠sicament el disc dels redo logs amb altres fitxers cr√≠tics</li>
  <ul><li>Els fitcher REDO deuen estar en altre disc f√≠sic</li></ul>
</ul>
 
</section>
  



  <section id="logs">
  <h2>üßæ Fitxers log </h2>
   <h3> Qu√® s√≥n els fitxers log?</h3>
     <p>
      Els <strong>logs</strong> en Oracle fan refer√®ncia als fitxers de registre que el sistema genera autom√†ticament per monitorar l‚Äôactivitat, errors i operacions internes.
      Aquests fitxers s√≥n imprescindibles per a qualsevol tasca de diagn√≤stic o auditoria.
    </p>

    <h3> Tipus de logs</h3>
    <ul>
      <li><strong>Alert log</strong>: fitxer principal del sistema, mostra missatges d‚Äôarrencada, aturada, errors greus, missatges de SHUTDOWN i STARTUP.</li>
      <li><strong>Trace files</strong>: fitxers de seguiment detallat per a processos espec√≠fics o errors concrets.</li>
      <li><strong>Listener log</strong>: fitxer que recull les connexions i activitats del listener.</li>
      <li><strong>log d'instal¬∑laci√≥ del SW</strong>: fitxer que recull les accions d'instal¬∑laci√≥.</li>
      <li><strong>log d'instal¬∑laci√≥ de la BBDD</strong>: fitxer que recull les accions d'instal¬∑laci√≥.</li>
      <li><strong>log d'instal¬∑laci√≥ de Patch/upgrades</strong>: fitxer que recull les accions d'instal¬∑laci√≥.</li>
      <li><strong>log de c√≤pies de seguretat</strong>: fitxer que recull les accions de c√≤pies de seguretat (fetes o fallides) de Datapump i RMAN.</li>
      <li><strong>log d'administraci√≥ de WEB d'OEM</strong>: Oracle Enterprise Manager</li>
    </ul>
  
    <h3>üìÅ Ubicaci√≥ dels fitxers</h3>
    <ul>
      <li><strong>Unix/Linux:</strong>  
        <pre>$ORACLE_BASE/diag/rdbms/&lt;db_name&gt;/&lt;sid&gt;/trace/</pre>
      </li>
      <li><strong>Windows:</strong>  
        <pre>%ORACLE_BASE%\diag\rdbms\<db_name>\&lt;sid&gt\trace\</pre>
      </li>
    </ul>
  
    <p>El fitxer d‚Äôalertes sol anomenar-se:</p>
    <pre>alert_SID_.log</pre>

    <p class="alert">üß™ Practica: Busca en la maquina servidor tots els fitxers que continguen la paraula "alert" (i la seua ruta). 
      Despr√©s, fes una classificaci√≥ dels fitxers de log i relaciona amb les variables d'entorn (ORACLE_BASE, ORACLE_HOME, etc)</p>
  
    <h3>üîç Consultar l‚Äôalert log</h3>
    <p>Es pot visualitzar amb qualsevol editor de text, per√≤ tamb√© es pot consultar des de SQL amb:</p>
    <pre>
  SQL> SELECT value FROM v$diag_info WHERE name = 'Diag Trace';
    </pre>
  
    <p>Tamb√© pots consultar entrades recents:</p>
    <pre>
  $ tail -f alert_costera.log   # En temps real (Linux)
    </pre>
  
    <h3>üìû Listener log</h3>
    <p>El fitxer de registre del listener mostra informaci√≥ sobre connexions, errors i temps de resposta.</p>
    <p>Ubicaci√≥ t√≠pica:</p>
    <pre>
  $ORACLE_BASE/diag/tnslsnr/&lt;host&gt;/listener/trace/listener.log
    </pre>
  
    <h3> Recomanacions</h3>
    <ul>
      <li> Revisa l‚Äô<strong>alert log</strong> despr√©s de qualsevol <code>startup</code>, <code>shutdown</code> o error inesperat</li>
      <li> Configura eines de rotaci√≥ de logs per evitar que ocupin massa espai</li>
      <li> Utilitza <code>v$diag_info</code> per consultar rutes oficials dels directoris</li>
      <li> Els trace files poden ajudar a identificar errors que no apareixen en altres llocs</li>
    </ul>
  
    <h3> Ordre √∫til</h3>
    <pre>
  SQL> SELECT name, value FROM v$diag_info;
    </pre>
  
    <p>Aix√≤ te mostra totes les rutes del sistema de diagn√≤stic: logs, trace, incidents, etc.</p>

  </section>
  

  <section id="altres-recursos">
    <h2>Recursos addicionals</h2>
    <h3> <a href="https://github.com/EnriqueIborra/ASGBD/blob/main/UD2/ASGBD-UD2.2%20Tablespaces%20i%20datafiles_simple.pdf">üéØ Tablespaces i Datafiles</a> </h3>
    <h3><a href="https://github.com/EnriqueIborra/ASGBD/blob/main/UD2/ASGBD-UD2.4%20Us%20d%20sqlplus.pdf" target="_blank">üéØ √ös d'sqlplus</a> </h3>
    <h3> <a href="https://github.com/EnriqueIborra/ASGBD/blob/45a0bb752d27338cb918cf1bca25649af09132cd/UD2/ASGBD-UD2.4%20Us%20de%20vi.pdf" target="_blank">üéØ √ös de  <code>vi</code></a>  </h3>
    <h3> <a href="https://github.com/EnriqueIborra/ASGBD/blob/3110bfbccca9c294245e153db8cffb709ace32b0/UD2/ASGBD-UD2.3%20Dates-Oracle.pdf" target="_blank">üéØ Gesti√≥ de Dates en ORACLE</a></h3>
    
  </section>
 

</main>

<script>

  // Per poder copiar codi en el porta-retalls. S'ha de posar un bot√≥ en cada <pre>
      //  <div class="pre-container">
      //    <button class="copy-button">Copia Codi !</button>
  document.addEventListener('DOMContentLoaded', function () {
    const buttons = document.querySelectorAll('.copy-button');

    buttons.forEach(button => {
      button.addEventListener('click', function () {
        const code = this.nextElementSibling.innerText;
        navigator.clipboard.writeText(code).then(() => {
          this.innerText = ' ‚úî Copiat!';
          setTimeout(() => this.innerText = 'Copia Codi !', 3000);
        });
      });
    });
  });

</script>

</body>
</html>
