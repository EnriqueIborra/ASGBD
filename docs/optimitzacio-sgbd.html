<!DOCTYPE html>
<html lang="ca">
<head>
  <meta charset="UTF-8">
  <title>üìà Monitoritzar Oracle</title>
  <link rel="stylesheet" href="estilsunitats.css">
</head>
<body>

<header>
  <a href="index.html">
    <img src="https://upload.wikimedia.org/wikipedia/commons/5/50/Oracle_logo.svg" alt="Oracle Logo">
  </a>
  <h1>ASGBD   -    Monitoritzaci√≥ i Optimitzaci√≥</h1>
</header>

<nav>
  <h2>√çndex</h2>
  <a href="#monitoratge">Monitoratge</a>
  <a href="#optimitzacio">Optimitzaci√≥</a>
  <a href="#optimitzacio-oracle">Optimitzaci√≥ en ORACLE</a>
  <a href="#eines-optimitzacio">Eines d'optimitzaci√≥</a>  
</nav>

<main>

  <section id="monitoratge">
    <h2> Monitoratge del Sistema Gestor de Bases de Dades (SGBD)</h2>
  
    <h3> Qu√® √©s el monitoratge?</h3>
    <p>
      El <strong>monitoratge</strong> √©s el proc√©s de controlar el funcionament del sistema gestor, detectant possibles errors o situacions que puguin afectar el rendiment. 
      Ha de ser <strong>poc intrusiu</strong>, per tal de no interferir en el funcionament normal del sistema.
    </p>
  
    <h3>üß∞ Eines principals de monitoratge</h3>
    <ul>
      <li> <strong>Monitor de rendiment</strong>: analitza c√†rrega, processos i consum de recursos.</li>
      <li> <strong>Log d‚Äôexecuci√≥</strong>: recull errors, avisos i operacions importants.</li>
      <li> <strong>Diccionari de dades (DD)</strong>: permet fer consultes per monitorar sessions, bloquejos, consultes actives, etc.</li>
    </ul>
  
    <h3> Monitor de rendiment</h3>
    <ul>
      <li>Seguiment de m√®triques de temps de resposta, concurr√®ncia i escalabilitat.</li>
      <li>Detecci√≥ de bloquejos i processos acaparadors.</li>
      <li>Configuraci√≥ d‚Äôalertes i llindars.</li>
    </ul>
  
    <h4> Dades rellevants</h4>
    <ul>
      <li>Temps de resposta i transaccions per usuari</li>
      <li>Escalabilitat i concurr√®ncia</li>
      <li>√ös de CPU, mem√≤ria i IO</li>
    </ul>
  
    <h3>üìù Registre d‚Äôerrors (logs)</h3>
    <p>
      Registra activitats com arrencades, aturades, errors, consultes lentes, etc.
    </p>
    <ul>
      <li> <strong>Error</strong>: problemes greus</li>
      <li> <strong>Warning</strong>: advert√®ncies</li>
      <li> <strong>Debug</strong>: informaci√≥ detallada (en desenvolupament)</li>
    </ul>
  
    <h4>üìÅ Exemples de fitxers de registre</h4>
    <ul>
      <li><code>alert.log</code></li>
      <li><code>trace</code></li>
      <li><code>incident</code></li>
      <li>Ubicaci√≥: <code>ORACLE_BASE/diag</code> (ADR - Automatic Diagnostic Repository)</li>
    </ul>
  
    <h3>üìö Diccionari de Dades (DD)</h3>
    <p>
      Conjunt de vistes com <code>v$session</code>, <code>v$sqlarea</code>, <code>v$diag_info</code>, etc. que permeten:
    </p>
    <ul>
      <li>Consultar qui est√† connectat i qu√® executa</li>
      <li>Detectar consultes pesades o bloquejos</li>
      <li>Visualitzar informaci√≥ de rendiment</li>
    </ul>
  
    <p> Exemple:</p>
    <pre>
  SELECT * FROM v$session;
  SELECT * FROM v$sqlarea;
  SELECT * FROM v$diag_info;
    </pre>
  
    <h3>üñ•Ô∏è Monitoratge gr√†fic (SQL Developer, TOAD...)</h3>
    <ul>
      <li>Historial de consultes (Ver ‚Üí DBA)</li>
      <li>ASH (Active Session History)</li>
      <li>AWR (Automatic Workload Repository)</li>
      <li>Top SQL, Sessions, Tasques de llarga durada</li>
    </ul>
  
    <p> Tamb√© es pot fer des de l‚ÄôEnterprise Manager (deprecated) o des de <code>Herramientas ‚Üí Controlar sesiones</code> en SQL Developer.</p>
  
    <h3> Pr√†ctica recomanada</h3>
    <ul>
      <li>Prioritzar consultes al Diccionari de Dades abans que eines gr√†fiques (consumeixen menys recursos)</li>
      <li>Fer monitoratge profund en hores de baixa c√†rrega</li>
      <li>Configurar alertes amb SCHEDULER o sistemes externs</li>
    </ul>
  
    <h3> Resum de bones pr√†ctiques</h3>
    <ul>
      <li> Supervisar l‚Äôactivitat del sistema peri√≤dicament</li>
      <li> Detectar i gestionar sessions bloquejades</li>
      <li> Reaccionar a errors recurrents als logs</li>
      <li> Fer √∫s de vistes com <code>v$session</code>, <code>v$active_session_history</code>, etc.</li>
    </ul>
  </section>
    



  <section id="optimitzacio">
    <h2> Optimitzaci√≥ del SGBD</h2>
  
    <h3>üéØ Objectiu</h3>
    <p>
      L‚Äôobjectiu de l‚Äôoptimitzaci√≥ √©s <strong>millorar el rendiment</strong> del sistema, tot reduint els temps de resposta, l‚Äô√∫s de recursos i l‚Äôimpacte en l‚Äôusuari final. 
      No es tracta nom√©s de fer que les consultes funcionin, sin√≥ que siguin <strong>r√†pides i eficients</strong>.
    </p>
  
    <h3> Aspectes a optimitzar</h3>
    <ul>
      <li> Disseny f√≠sic (estructura de taules i √≠ndexs)</li>
      <li> Qualitat de les consultes SQL</li>
      <li> Estad√≠stiques del sistema</li>
      <li> Configuraci√≥ i par√†metres del SGBD</li>
    </ul>
  
    <h3> Pr√†ctiques recomanades per a consultes</h3>
    <ul>
      <li> Utilitza <code>EXPLAIN PLAN</code> per analitzar l'estrat√®gia de consulta</li>
      <li> Evita <code>SELECT *</code>: nom√©s demana les columnes necess√†ries</li>
      <li> Evita subconsultes correlacionades no indexades</li>
      <li> Fes √∫s de joins eficients (preferentment expl√≠cits)</li>
      <li> Controla l‚Äô√∫s de funcions sobre columnes indexades</li>
    </ul>
  
    <h3>üìä √çndexs</h3>
    <p>
      Els <strong>√≠ndexs</strong> permeten accedir m√©s r√†pidament a dades. Cal usar-los correctament:
    </p>
    <ul>
      <li> Columna freq√ºentment filtrada (WHERE)</li>
      <li> Columnes utilitzades en JOINs</li>
      <li>‚ö†Ô∏è No crear √≠ndexs per defecte a totes les columnes (consumeixen espai i poden alentir INSERT/UPDATE)</li>
    </ul>
  
    <h4>üîß Crear un √≠ndex</h4>
    <pre>
  CREATE INDEX idx_nom ON alumnes(nom);
    </pre>
  
    <h3>üìà Estad√≠stiques i optimitzador</h3>
    <p>
      Oracle utilitza l‚Äô<strong>optimitzador basat en costos</strong> (CBO) i es basa en estad√≠stiques per determinar el millor pla d‚Äôexecuci√≥.
    </p>
    <pre>
  -- Actualitzar estad√≠stiques
  EXEC DBMS_STATS.GATHER_TABLE_STATS(ownname=>'USUARI', tabname=>'ALUMNES');
    </pre>
  
    <h3>üß™ EXPLAIN PLAN</h3>
    <p>
      Serveix per veure com Oracle executar√† una consulta. Mostra si s‚Äôutilitzen √≠ndexs, escaneigs complets, joins, etc.
    </p>
    <pre>
  EXPLAIN PLAN FOR
  SELECT * FROM alumnes WHERE edat > 18;
  
  SELECT * FROM TABLE(DBMS_XPLAN.DISPLAY);
    </pre>
  
    <h3>üõë Consultes ineficients</h3>
    <p>Exemples a evitar:</p>
    <ul>
      <li><code>SELECT * FROM taula;</code> ‚Üí molt cost√≥s si t√© moltes columnes</li>
      <li><code>WHERE TO_CHAR(data, 'YYYY') = '2023'</code> ‚Üí trenca √≠ndexs</li>
      <li><code>WHERE UPPER(nom) = 'JOAN'</code> ‚Üí si no hi ha √≠ndex amb UPPER</li>
    </ul>
  
    <h3> Versions millorades</h3>
    <pre>
  -- Evitar funcions sobre columnes
  WHERE data >= TO_DATE('01/01/2023', 'DD/MM/YYYY')
  
  -- Substituir subconsulta per JOIN
  SELECT a.nom, c.nom_curs
  FROM alumnes a
  JOIN cursos c ON a.curs_id = c.id;
    </pre>
  
    <h3> Altres consells d‚Äôoptimitzaci√≥</h3>
    <ul>
      <li> Usa <code>BULK COLLECT</code> i <code>FORALL</code> per treballar amb grans volums en PL/SQL</li>
      <li> Utilitza particions en taules molt grans</li>
      <li> Evita bloquejos i transaccions llargues</li>
    </ul>
  
    <h3> Resum de bones pr√†ctiques</h3>
    <ul>
      <li> Coneix el model de dades i el volum</li>
      <li> Usa EXPLAIN PLAN sovint</li>
      <li> Mant√©n estad√≠stiques al dia</li>
      <li> Indexa amb criteri</li>
      <li> Millora consultes repetitives o lentes</li>
    </ul>
  </section>
  



  <section id="optimitzacio-oracle">
    <h2> Optimitzaci√≥ en Oracle</h2>
  
    <h3> L'optimitzador</h3>
    <p>
      Oracle utilitza un component anomenat <strong>optimitzador</strong> per determinar el millor pla d‚Äôexecuci√≥ per a una consulta SQL.
      L‚Äôobjectiu √©s minimitzar el temps d‚Äôexecuci√≥ i l‚Äô√∫s de recursos.
    </p>
  
    <h4> Tipus d‚Äôoptimitzadors</h4>
    <ul>
      <li><strong>Rule-Based (RBO)</strong>: basat en regles predeterminades (obsolet)</li>
      <li><strong>Cost-Based (CBO)</strong>: basat en costos calculats amb estad√≠stiques (actual i recomanat)</li>
    </ul>
  
    <h3>üìä Estad√≠stiques</h3>
    <p>
      L‚Äôoptimitzador CBO utilitza <strong>estad√≠stiques</strong> sobre les taules, columnes i √≠ndexs per decidir l‚Äôestrat√®gia d‚Äôexecuci√≥.
    </p>
  
    <h4> Com generar estad√≠stiques</h4>
    <pre>
  EXEC DBMS_STATS.GATHER_TABLE_STATS('USUARI', 'TAULA');
    </pre>
  
    <p>Tamb√© es poden automatitzar mitjan√ßant tasques de manteniment o recollida autom√†tica de l‚ÄôOracle Scheduler.</p>
  
    <h3>üìà EXPLAIN PLAN</h3>
    <p>
      Aquesta comanda permet visualitzar el pla que Oracle seguir√† per executar una consulta. Ajuda a detectar consultes lentes o mal optimitzades.
    </p>
  
    <h4> Exemple d‚Äô√∫s</h4>
    <pre>
  EXPLAIN PLAN FOR
  SELECT * FROM alumnes WHERE edat > 18;
  
  SELECT * FROM TABLE(DBMS_XPLAN.DISPLAY);
    </pre>
  
    <h4> Resultats comuns:</h4>
    <ul>
      <li><code>TABLE ACCESS FULL</code> ‚Üí Oracle escaneja tota la taula</li>
      <li><code>INDEX RANGE SCAN</code> ‚Üí fa servir un √≠ndex parcial</li>
      <li><code>NESTED LOOPS</code>, <code>HASH JOIN</code> ‚Üí tipus d‚Äôestrat√®gies de join</li>
    </ul>
  
    <h3> Factors que afecten el pla d‚Äôexecuci√≥</h3>
    <ul>
      <li>Disponibilitat d‚Äô√≠ndexs</li>
      <li>Estad√≠stiques actualitzades</li>
      <li>Volum de dades</li>
      <li>Condicions de filtre i joins</li>
    </ul>
  
    <h3>‚ö†Ô∏è Errors habituals d‚Äôoptimitzaci√≥</h3>
    <ul>
      <li>Fer servir <code>SELECT *</code> en comptes de nom√©s les columnes necess√†ries</li>
      <li>Aplicar funcions sobre columnes en condicions (<code>WHERE UPPER(nom)</code>) ‚Üí trenca √≠ndexs</li>
      <li>No tenir √≠ndexs sobre claus foranes o condicions de filtre</li>
      <li>Oblidar actualitzar estad√≠stiques</li>
    </ul>
  
    <h3> Altres eines d‚Äôoptimitzaci√≥</h3>
    <ul>
      <li> <strong>DBMS_XPLAN</strong> ‚Üí mostra el pla d‚Äôexecuci√≥ amb m√©s detall</li>
      <li> <strong>AWR</strong> (Automatic Workload Repository) ‚Üí historial de rendiment</li>
      <li> <strong>ASH</strong> (Active Session History) ‚Üí activitat de sessions en temps real</li>
    </ul>
  
    <h3> Recomanacions generals</h3>
    <ul>
      <li> Revisa les consultes lentes amb EXPLAIN PLAN</li>
      <li> Actualitza estad√≠stiques sovint</li>
      <li> Fes servir √≠ndexs de manera estrat√®gica</li>
      <li> Prova diferents opcions de joins segons el volum i condicions</li>
      <li> Evita accessos complets si pots usar √≠ndexs</li>
    </ul>
  
    <h3> Exemple de consulta optimitzada</h3>
    <p>Consulta original (lenta):</p>
    <pre>
  SELECT * FROM alumnes WHERE TO_CHAR(data_naixement, 'YYYY') = '2005';
    </pre>
  
    <p>Versi√≥ optimitzada:</p>
    <pre>
  SELECT * FROM alumnes
  WHERE data_naixement BETWEEN TO_DATE('01/01/2005', 'DD/MM/YYYY')
                          AND TO_DATE('31/12/2005', 'DD/MM/YYYY');
    </pre>
  
    <h3>üí¨ Conclusi√≥</h3>
    <p>
      L‚Äôoptimitzaci√≥ en Oracle es basa en la col¬∑laboraci√≥ entre el desenvolupador i l‚Äôoptimitzador del sistema. 
      Mantenir estad√≠stiques actualitzades, evitar males pr√†ctiques i revisar plans d‚Äôexecuci√≥ s√≥n claus per un rendiment √≤ptim.
    </p>
  </section>
  




  <section id="eines-optimitzacio">
    <h2> Eines d'optimitzaci√≥ en Oracle</h2>
  
    <h3>üéØ Objectiu</h3>
    <p>
      Aquestes eines permeten <strong>analitzar el rendiment</strong> de consultes SQL, sessions i c√†rregues del sistema, ajudant a diagnosticar colls d‚Äôampolla i a optimitzar els accessos a dades.
    </p>
  
    <hr>
  
    <h3> 1. EXPLAIN PLAN</h3>
    <p>
      Mostra el pla d‚Äôexecuci√≥ previst per Oracle per a una consulta. Ajuda a detectar si s‚Äôutilitzen √≠ndexs o si es fa un escaneig complet de taula.
    </p>
    <pre>
  EXPLAIN PLAN FOR
  SELECT * FROM alumnes WHERE edat > 18;
  
  SELECT * FROM TABLE(DBMS_XPLAN.DISPLAY);
    </pre>
  
    <p><strong>Sortides habituals:</strong></p>
    <ul>
      <li><code>TABLE ACCESS FULL</code> ‚Üí acc√©s complet (lenta)</li>
      <li><code>INDEX RANGE SCAN</code> ‚Üí acc√©s parcial mitjan√ßant √≠ndex</li>
      <li><code>HASH JOIN</code>, <code>NESTED LOOPS</code> ‚Üí estrat√®gies de join</li>
    </ul>
  
    <hr>
  
    <h3> 2. DBMS_XPLAN</h3>
    <p>
      Paquet que permet mostrar el pla d‚Äôexecuci√≥ amb m√©s claredat, incloent cost, l√≠nies estimades, filtre aplicat, etc.
    </p>
  
    <h4> Exemple:</h4>
    <pre>
  SELECT * FROM TABLE(DBMS_XPLAN.DISPLAY);
    </pre>
  
    <p>Per veure el pla real d‚Äôuna consulta ja executada:</p>
    <pre>
  SELECT * FROM TABLE(DBMS_XPLAN.DISPLAY_CURSOR(NULL, NULL, 'ALLSTATS LAST'));
    </pre>
  
    <hr>
  
    <h3> 3. AUTOTRACE</h3>
    <p>
      Mostra autom√†ticament el pla d‚Äôexecuci√≥ i estad√≠stiques despr√©s d‚Äôexecutar una consulta.
    </p>
  
    <h4> Activar AUTOTRACE a SQL*Plus:</h4>
    <pre>
  SET AUTOTRACE ON;
  SELECT * FROM alumnes WHERE edat > 18;
    </pre>
  
    <p><strong>Resultat:</strong> mostra el cost, nombre de lectures, l√≠nies retornades i acc√©s utilitzat.</p>
  
    <hr>
  
    <h3> 4. AWR (Automatic Workload Repository)</h3>
    <p>
      Recull m√®triques de rendiment cada hora. Permet fer comparatives, generar informes i detectar canvis de rendiment.
    </p>
  
    <h4>üìù Informes AWR:</h4>
    <pre>
  @$ORACLE_HOME/rdbms/admin/awrrpt.sql
    </pre>
  
    <ul>
      <li>Comparativa entre snapshots</li>
      <li>Identificaci√≥ de top SQL (consultes m√©s pesades)</li>
      <li>√ös de recursos (CPU, I/O, etc.)</li>
    </ul>
  
    <hr>
  
    <h3> 5. ASH (Active Session History)</h3>
    <p>
      Mostra l‚Äôactivitat de les sessions que han estat actives en els darrers minuts. Ideal per veure quines consultes estan causant c√†rrega.
    </p>
  
    <h4>üîç Exemple de consulta ASH:</h4>
    <pre>
  SELECT sql_id, session_id, wait_class, event, sample_time
  FROM v$active_session_history
  WHERE sample_time > SYSDATE - 1/24;
    </pre>
  
    <p><strong>Requereix:</strong> llic√®ncia Oracle Enterprise Edition + Pack Diagn√≤stic</p>
  
    <hr>
  
    <h3> Altres eines √∫tils</h3>
    <ul>
      <li><code>V$SQL</code>, <code>V$SESSION</code> ‚Üí consultes actives i sessions en curs</li>
      <li>SQL Developer ‚Üí gr√†fics de sessions, consultes i objectes bloquejats</li>
      <li>TOAD ‚Üí monitoratge gr√†fic per a desenvolupadors</li>
      <li>Enterprise Manager (si est√† disponible)</li>
    </ul>
  
    <hr>
  
    <h3> Bones pr√†ctiques</h3>
    <ul>
      <li> Revisa plans amb EXPLAIN PLAN abans de desplegar consultes</li>
      <li> Activa AUTOTRACE si treballes amb SQL*Plus</li>
      <li> Usa AWR i ASH per detectar canvis de rendiment entre per√≠odes</li>
      <li>‚ö†Ô∏è Evita EXPLAIN PLAN sobre consultes complexes sense context</li>
    </ul>
  
    <h3> Conclusi√≥</h3>
    <p>
      Les eines d‚Äôoptimitzaci√≥ d‚ÄôOracle et permeten <strong>monitorar i millorar</strong> el comportament del teu sistema, evitant colls d‚Äôampolla i millorant l‚Äôexperi√®ncia d‚Äôusuari.
    </p>
  </section>
  
  



</main>


<script>

  // Per poder copiar codi en el porta-retalls. S'ha de posar un bot√≥ en cada <pre>
      //  <div class="pre-container">
      //    <button class="copy-button">Copia Codi !</button>
  document.addEventListener('DOMContentLoaded', function () {
    const buttons = document.querySelectorAll('.copy-button');

    buttons.forEach(button => {
      button.addEventListener('click', function () {
        const code = this.nextElementSibling.innerText;
        navigator.clipboard.writeText(code).then(() => {
          this.innerText = ' ‚úî Copiat!';
          setTimeout(() => this.innerText = 'Copia Codi !', 3000);
        });
      });
    });
  });

</script>

</body>
</html>
